\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage[spanish, mexico]{babel}
\usepackage[export]{adjustbox}
\usepackage{hyperref, amsmath, xcolor, mdframed, listings, tikz, enumitem}
\usetikzlibrary{shapes, arrows, chains, fit, calc} 

%\usepackage{showframe}


\newcommand{\crule}[2][1pt]
    {\begin{center}\rule{#2\textwidth}{#1}\end{center}}

\newcommand{\red}[1]	    {\textcolor{red}{#1}}


\newcommand\refcode[2]{ \href{#1}{\texttt{#2}} }

\newenvironment{note}
    {\begin{mdframed}[leftmargin=1cm, 
                 skipabove=1em,
                 skipbelow=1em,
                 rightline=false, 
                 topline=false,
                 bottomline=false,
                 linewidth=2pt]
        \textbf{Nota}\\}
    {\end{mdframed}}
    



\title{ \includegraphics[scale=0.6, right]{itesm_logo}
	    \\[4em] 
        Sistemas Conexionistas y Evolutivos
        \\[2em]
        $1^\text{er}$ parcial: reporte % babel shorthands don't work in macros.
        \\[1em]
        }
\author{ \vspace*{\fill} \red{ Personal Data} \qquad\small \red{Axxxxxxxx} \\[1em] }

\date{ \vspace*{\fill} \today, Puebla.}


\begin{document}
\lstset{language=Haskell, frame=single, 
    keywordstyle=\color{blue}, 
    deletekeywords={min,max},
    otherkeywords={N8}
    }

\maketitle
\newpage

\def\ImgCharRoot{run:./docs/image-characteristics}
\def\ImgCharacteristics{\ImgCharRoot/ImgCharacteristics.html}
\def\Friday{\ImgCharRoot/ImgCharacteristics-Friday.html}
\def\Extractors{\ImgCharRoot/ImgCharacteristics-Friday-Extractors.html}
\def\ExtractorBuilder{\ImgCharRoot/ImgCharacteristics-ExtractorBuilder.html}
\def\GTK{\ImgCharRoot/ImgCharacteristics-GTK.html}
\def\Weka{\ImgCharRoot/ImgCharacteristics-Weka.html}

\def\ExecAll{run:./docs/image-characteristics/img-chv_descriptive-stats_all/src/Main.html}

\def\Nat{run:./docs/Nat/frames.html}
\def\WekaData{run:./docs/WekaData/frames.html}

\section{Base de imágenes}

Se seleccionaron 42 imágenes de bosques \underline{con resoluciones diferentes}, 36 de las cuales contienen incendios forestales. Seis mas no contienen ningún signo de fuego, y tres de ellas presentan un bosque en otoño con las hojas de color. Las imágenes se adjuntan en archivo \textit{images.zip}.

\begin{note}
La partición de imágenes en regiones se adapta al tamaño de la imagen, lo que permite recibir regiones con desviaciones de tamaño reducidas. Ademas, el vector de características se forma por los valores estadísticos de la región, los cuales no están afectados por la diferencia en el tamaño de la muestra.
\end{note}


\section{Partición de imágenes}

El proceso de partición es parte de la aplicación \verb|image-characteristics|, la cual se discute mas detalladamente en la siguiente sección.

Esta representado por un \href{http://learnyouahaskell.com/types-and-typeclasses}{\emph{clase de tipos}} \verb|RegionsExtractor| en el archivo 
\refcode{\ImgCharacteristics}{src/ImgCharacteristics.hs}.
Al momento tiene una implementación para \verb|FixedColRowRegions|, el cual describe:
\begin{enumerate}
\item el número de filas deseado (el número máximo);
\item el número de columnas deseado (el número máximo);
\item el tamaño mínimo de un \emph{región}.
\end{enumerate}

La implementación se llama \verb|fixedColRowRegions| y se encuentra en\\ \refcode{\Friday}{src/ImgCharacteristics/Friday.hs}. Utiliza la función \verb|finalSize| para encontrar el número máximo de columnas y filas, que producirán regiones de tamaño no menor al establecido por \verb|FixedColRowRegions|. La partición de la imagen se hace con la función \href{https://hackage.haskell.org/package/friday-0.2.2.0/docs/Vision-Image-Transform.html}{\emph{crop}} de la librería \verb|friday|.

Se espera la declaración de una \href{https://downloads.haskell.org/~ghc/7.0.1/docs/html/users_guide/type-class-extensions.html}{\emph{instancia}} de \verb|RegionsExtractor| en el modulo \verb|Main|, cómo en \refcode{\ExecAll}{exec/DescriptiveStatsAll.hs} (está diseñado de esta manera para evitar posibles \href{https://wiki.haskell.org/Multiple_instances}{conflictos} de importación).

\section{Vector de características}

Un vector de características se extrae de una región de imagen por las clases \verb|CharacteristicExtractor| y \verb|CharacteristicExtractors|, los cuales definen los extractores y sus nombres. Están basados en vectores, indexados con \href{https://wiki.haskell.org/Type_arithmetic}{\emph{números naturales en nivel de tipos}}, implementados en el proyecto \refcode{\Nat}{Nat}.

Los extractores mencionados se construían utilizando \verb|ChanelExtractor| y \verb|LinkedChanelExtractor|, definidos en \\ \refcode{\ExtractorBuilder}{src/ImgCharacteristics/ExtractorBuilder.hs}.


Para el problema dado se utilizan los siguientes extractores de canales, definidos en \refcode{\Extractors}{src/ImgCharacteristics/Friday/Extractors.hs}:
\begin{itemize}
\item \verb|mean| --- la esperanza matemática;
\item \verb|meanQuadratic| --- la media cuadrática, $\sqrt{\frac{\sum\limits_{i=1}^n x_i^2}{n}}$;
\item \verb|stdev'| --- la desviación estándar, requiere valor de la media;
\item \verb|min| --- el valor mínimo ($Q_0$);
\item \verb|max| --- el valor máximo ($Q_5$);
\item \verb|quartiles| --- los cuartiles $Q_1, Q_2, Q_3$;
\end{itemize}

En total son \textbf{8} características. \\

\noindent Los extractores de canales se aplican a cada canal de la región (independientemente). Un vector de características tiene dimensión \emph{número de características} $\times$ \emph{número de canales}.

\medskip

\noindent Definición de \verb|ChanelExtractor| utilizado:
\begin{lstlisting}
import ImgCharacteristics.Friday.Extractors as CE

descriptiveStats :: ( NatRules n, Floating num
                    , Ord num, GenVec n
                    , NatRules3Pack n
                    ) => ChanelExtractor n num N8
descriptiveStats =    CE.min
                  +#  CE.quartiles
                  +#  CE.max
                  +#  CE.meanQuadratic
                  +## CE.meanAndVar
\end{lstlisting}

\medskip

Para transformar \verb|ChanelExtractor| a \verb|CharacteristicsExtractor| se utilizan las funciones \verb|extractorRGB|, \verb|extractorHSV| y \verb|extractorGrey|.

Se encuentran en \refcode{\Friday}{src/ImgCharacteristics/Friday.hs}.\\

En el ejecutable utilizado (\refcode{\ExecAll}{exec/DescriptiveStatsAll.hs}) se combinan los extractores \verb|RGB, HSV, Grey| para recibir vectores de dimensión \emph{56} ($8\times3 + 8\times3 + 8\times1$).

\section{Datos de aprendizaje}

Para el aprendizaje \emph{supervisado}, se requieren las etiquetas de clase para cada instancia de los datos. El funcionamiento de selección de etiquetas está definido por la clase \verb|RegionsClassesProvider| (en \refcode{\ImgCharacteristics}{src/ImgCharacteristics.hs}) y está diseñado para una acción de \href{https://www.haskell.org/tutorial/io.html}{\emph{entrada/salida}}. Provee dos funciones:
\begin{enumerate}
    \item \verb|classProvider| --- crea una instancia de \verb|RegionsClassesProvider|;
    \item \verb|regionClass| --- pregunta la clase de la imagen (región).
\end{enumerate}

Específicamente, está implementado a través de ``GIMP Toolkit'' (GTK), el cual se utiliza para la interfaz gráfica ``GNOME''. La interfaz de la ventana está proveída por un contenedor \verb|ClassesInterview|, definido en \\ \refcode{\GTK}{src/ImgCharacteristics/GTK.hs}, el cual provee:
\begin{itemize}
    \item \verb|ciWindow| --- el objeto de la ventana gráfica;
    \item \verb|ciAskClass| --- una función \verb|a -> IO class'|, dónde \verb|a| es una 
                                imagen (una región);
    \item \verb|ciDestroy| --- una función para destruir la interfaz gráfica.
\end{itemize}

\crule{1}
\medskip
Creación del \verb|ClassesInterview|:
\medskip

\input{ClassesInterview.tikz}

\medskip
Interrogación del usuario \verb|extractLearnData| \\ en \refcode{ImgCharacteristics}{src/ImgCharacteristics.hs} y \refcode{\GTK}{src/ImgCharacteristics/GTK.hs}:
\medskip

\input{extractLearnData.tikz}

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{interview.png}
    \caption{La interfaz gráfica.}
\end{figure}

\subsection{Clases de regiones}
Se utilizan \textbf{5} clases (\refcode{\ExecAll}{exec/DescriptiveStatsAll.hs}):
\begin{enumerate}
    \item \verb|Fire|
    \item \verb|Smoke|
    \item \verb|Fire&Smoke|
    \item \verb|Neither|
    \item \verb|Ignore|
\end{enumerate}

Las instancias etiquetadas con \verb|Ignore| están a la espera de ser removidos.

\subsection{Formato ARFF}

Para la escritura de los datos se utiliza el proyecto \refcode{\WekaData}{WekaData}; el código fuente se incluye en el archivo \verb|WekaData.zip|.

Los adaptadores entre \verb|LearnDataEntry| y \verb|WekaEntry| se encuentran en\\ \refcode{\Weka}{src/ImgCharacteristics/Weka.hs}.

\subsection{Ejecutable}
El proyecto provee varios ejecutables, pero \verb|img-chv_descriptive-stats_all| es el que se usa (\refcode{\ExecAll}{exec/DescriptiveStatsAll.hs}).

Tiene dos modos de uso:
\begin{enumerate}
\item \texttt{img-chv\_descriptive-stats\_all} \textit{images relation target}
\item \texttt{img-chv\_descriptive-stats\_all} \verb|--dir| 
       \textit{directory relation target}
    \begin{itemize}[leftmargin=2cm]
        \item[\textit{images}]   --- enumeración de imágenes;
        \item[\textit{directory}]--- un directorio con imágenes a procesar;
        \item[\textit{relation}] --- nombre de la relación (\verb|@relation|);
        \item[\textit{target}]   --- el archivo \emph{*.arff} a escribir.
    \end{itemize}
\end{enumerate}

\subsection{Compilación}

Requiere:
\begin{itemize}
    \item The Glorious Glasgow Haskell Compilation System (GHC), version 7.10.3.
    \item Common Architecture for Building Applications and Libraries (CABAL),
          version $\geq$ 1.10.
    \item \emph{ghc-gtk3}, version $\geq$ 0.14 (puede ser complicada a compilar).
    \item Proyecto \emph{Nat}.
    \item Proyecto \emph{WekaData}.
\end{itemize}

Las demás dependencias deben ser resueltas por CABAL sin problemas.

\section{Experimentos en Weka}

Para automatizar el proceso de aprendizaje del perceptron, fue creado un pequeño proyecto en Scala. Se aprovecha la facilidad de conexión de aplicaciones de JMV para correr las \emph{evaluaciones} de Weka.

La ejecutable prepara los datos, removiendo las instancias marcadas con la clase \verb|Ignore|.



\end{document}

